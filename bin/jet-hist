#!/usr/bin/env python3

import os
import sys

if len(sys.argv) not in [2, 3, 4]:
    print(f'usage: {os.path.basename(sys.argv[0])} <dumpfile> [<partfile>] [<normalize>]', file=sys.stderr)
    sys.exit(1)
DUMPFILE = sys.argv[1]
PARTFILE = None if len(sys.argv) <= 2 else sys.argv[2]
if PARTFILE == '-': PARTFILE = None
NORMALIZE = True if len(sys.argv) <= 3 else eval(sys.argv[3])

main_path = os.path.join(os.path.dirname(__file__), '..')
sys.path.insert(0, os.path.join(main_path, 'src/python3'))

import adjet
import matplotlib.pyplot as plt

collection = adjet.collect(adjet.load_pf(DUMPFILE), None if not PARTFILE else adjet.load_cf(PARTFILE))

for i, name in zip([
    adjet.JET_NPAR,
    adjet.JET_PT,
    adjet.JET_SDMASS,
    adjet.JET_N2_0,
    adjet.JET_N3_10,
    adjet.JET_TAU21,
    adjet.JET_TAU32,
    adjet.JET_TAU43,
], ['npar', 'pt', 'sdmass', 'n2_0', 'n3_10', 'tau21', 'tau32', 'tau43']):
    collection.hist(i, bins=30, histtype='step', density=NORMALIZE)
    plt.legend(loc='upper right')
    plt.tight_layout()
    figpath = f'jet_{name}{"_norm" if NORMALIZE else ""}.pdf'
    print(f'creating {figpath}...')
    plt.savefig(figpath)
    plt.clf()
